# 数据库存档

#### 背景

业务背景：将数据库老数据转存到更廉价的文件存储服务，降低存储成本。

功能需求：根据条件加载数据库数据到内存，转成持久化格式（例如：csv），再上传到文件存储服务（例如：Amazon S3），最后从数据库删除已导出的数据。

#### 挑战

- 数据量过大
  - 内存溢出
  - 性能问题
- 可靠性
  - 实例宕机重启时，断点重传或者将任务分发给其他服务
  - 存储服务宕机时，回滚数据库已删除的数据，回滚文件存储服务已上传的数据

## 1.基本实现